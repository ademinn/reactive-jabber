\section{Реализация}
\subsection{Инструменты}
Для реализации был выбран язык программирования \emph{Haskell}\cite{haskell} и библиотека реактивного программирования \emph{reactive-banana}\cite{reactive-banana}.
Для создания графического интерфейса приложения использовалась библиотека \emph{gtk2hs}\cite{gtk2hs} (основанная на \emph{GTK+}\cite{gtk}).

\subsection{Модель}
При разработке с применением ФРП в первую очередь необходимо было построить модель, описывающую
игру, выделить требуемые события и сигналы, определить зависимости между ними.

Внутренним состоянием интерфейса является информация об активных чатах, и история переписки в них.
Такую информацию удобно представить в виде отображения из JID собеседников в структуру, хранящую необходимую информацию о чате.
Данное отображение представляется в виде кусочно-постоянного сигнала, изначально равного пустому отображению.
Добавление нового собеседника происходит в двух случаях:
\begin{itemize}
    \item от собеседника приходит сообщение;
    \item пользователь двойным кликом выбирает собеседника из своего списка контактов.
\end{itemize}
Для этих двух случаев созданы отдельные события,
первое из которых наступает при поступлении соответствующей информации от библиотеки для работы с XMPP,
а наступление второго управляется при помощи \emph{gtk2hs}.
На основе этих двух событий строится итоговое событие, наступление которого обозначает, что необходимо добавить нового собеседника.
Добавленные собеседники не удаляются из отображения до конца работы программы.

Полный список событий и сигналов привден в подразделе~\ref{events_and_signals}, а их взаимосвязь отражена на рис.~\ref{network}

\subsection{События и сигналы}\label{events_and_signals}
Интерфейс приложения управляется сетью событий.
К ее входам подключены следующие события:
\begin{itemize}
    \item eInStanza --- новая строфа от сервера:
    \begin{itemize}
        \item входящее сообщение;
        \item запрос на подписку;
        \item подтверждение подписка;
        \item отказ подписки;
    \end{itemize}
    \item eOutMsg --- новое исходящее сообщение;
    \item eDoubleClick --- двойной клик пользователя на одном из элементов списка контактов.
\end{itemize}
Выводами сети логики являются следующие события:
\begin{itemize}
    \item открыть новую вкладку;
    \item отобразить новое сообщение;
    \item отправить сообщение определенному собеседнику;
    \item отправить ответ пользователя на запрос авторизации;
    \item добавить новый элемент в список контактов;
    \item удалить элемент из списка контактов;
\end{itemize}

Предварительное проектирование и явное построение модели значительно упрощает следующий этап разработки --- написание исходного кода приложения.
Фактически, требуется перевести построенную модель в термины выбранного языка программирования.

\begin{figure}[р]
\centering
\input{scheme.tex}
\caption{Сеть событий пользовательского интерфейса}
\label{network}
\end{figure}

\begin{figure}[p]
\centering
\includegraphics{pic/login.png}
\caption{Окно авторизации}
\label{pic:login}
\end{figure}

\begin{figure}[p]
\centering
\includegraphics{pic/main.png}
\caption{Список контактов}
\label{pic:main}
\end{figure}

\begin{figure}[p]
\centering
\includegraphics{pic/chats.png}
\caption{Окно чатов}
\label{pic:chats}
\end{figure}
\clearpage
\input{code.tex}